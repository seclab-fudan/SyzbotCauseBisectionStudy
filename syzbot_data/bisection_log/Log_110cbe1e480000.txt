ci starts bisection 2023-01-25 08:13:06.115861466 +0000 UTC m=+219700.061923524
bisecting cause commit starting from 9d2f6060fe4c3b49d0cdc1dce1c99296f33379c8
building syzkaller on c692fab1c2ff0de2554c5940f77ac8c168e729b2
ensuring issue is reproducible on original commit 9d2f6060fe4c3b49d0cdc1dce1c99296f33379c8

testing commit 9d2f6060fe4c3b49d0cdc1dce1c99296f33379c8 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: d166308aaec285c5f2385ad05823e5d19139b821d0fd76750326d353d7edad9f
run #0: crashed: INFO: rcu detected stall in corrupted
run #1: crashed: INFO: rcu detected stall in corrupted
run #2: crashed: INFO: rcu detected stall in corrupted
run #3: crashed: INFO: rcu detected stall in corrupted
run #4: crashed: INFO: rcu detected stall in corrupted
run #5: crashed: INFO: rcu detected stall in corrupted
run #6: crashed: INFO: rcu detected stall in corrupted
run #7: crashed: INFO: rcu detected stall in corrupted
run #8: crashed: INFO: rcu detected stall in corrupted
run #9: crashed: INFO: rcu detected stall in corrupted
run #10: crashed: INFO: rcu detected stall in corrupted
run #11: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #12: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #13: crashed: INFO: task hung in rfkill_sync_work
run #14: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #15: crashed: INFO: task hung in rfkill_unregister
run #16: crashed: INFO: task hung in misc_open
run #17: crashed: INFO: task hung in rfkill_unregister
run #18: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #19: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v6.1
testing commit 830b3c68c1fb1e9176028d02ef86f3cf76aa2476 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 6f0639f585ad90cd49f4c8ba4e2163324928f03c0dfc7f75e15fa0b4c23e9c90
run #0: crashed: INFO: rcu detected stall in corrupted
run #1: crashed: INFO: rcu detected stall in corrupted
run #2: crashed: INFO: rcu detected stall in corrupted
run #3: crashed: INFO: rcu detected stall in corrupted
run #4: crashed: INFO: rcu detected stall in corrupted
run #5: crashed: INFO: rcu detected stall in corrupted
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in misc_open
run #8: crashed: INFO: task hung in misc_open
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v6.0
testing commit 4fe89d07dcc2804c8b562f6c7896a45643d34b2f gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 39f0e5dd8ad36138063f11607f130aca8a07f6c5ae81702fe443533b1b5716b9
run #0: crashed: INFO: rcu detected stall in corrupted
run #1: crashed: INFO: rcu detected stall in corrupted
run #2: crashed: INFO: rcu detected stall in corrupted
run #3: crashed: INFO: rcu detected stall in corrupted
run #4: crashed: INFO: rcu detected stall in corrupted
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in nfc_rfkill_set_block
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v5.19
testing commit 3d7cb6b04c3f3115719235cc6866b10326de34cd gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: f5cb75b761c51be1033e664820917d620c96137fa0a81c71bf13565a8b132a40
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in rfkill_sync_work
run #3: crashed: INFO: task hung in rfkill_unregister
run #4: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in misc_open
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v5.18
testing commit 4b0986a3613c92f4ec1bdc7f60ec66fea135991f gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: c46227d6f81387cf485729b1e5ee092a8e2f8517c09ba6e8134674ba4de455a8
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #3: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #4: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #5: crashed: INFO: task hung in rfkill_sync_work
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v5.17
testing commit f443e374ae131c168a065ea1748feac6b2e76613 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 3b908195cced496262e319c10e11e75328a7d3d3559ff8458ffa25ea8b8e89a5
run #0: crashed: INFO: task hung in rfkill_sync_work
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in rfkill_unregister
run #3: crashed: INFO: task hung in rfkill_unregister
run #4: crashed: INFO: task hung in rfkill_sync_work
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v5.16
testing commit df0cc57e057f18e44dac8e6c18aba47ab53202f9 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 941c6626e8d0189fe7ca36ff05643d78acea807001eb78055fac25245f217182
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #3: crashed: INFO: task hung in rfkill_sync_work
run #4: crashed: INFO: task hung in rfkill_unregister
run #5: crashed: INFO: task hung in misc_open
run #6: crashed: INFO: task hung in misc_open
run #7: crashed: INFO: task hung in rfkill_sync_work
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
testing release v5.15
testing commit 8bb7eca972ad531c9b149c0a51ab43a417385813 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 80213040ea75f1d9a10781bf1a60a1746953eed62fe1772502c0de9e0896a12d
all runs: OK
# git bisect start df0cc57e057f18e44dac8e6c18aba47ab53202f9 8bb7eca972ad531c9b149c0a51ab43a417385813
Bisecting: 7870 revisions left to test after this (roughly 13 steps)
[2219b0ceefe835b92a8a74a73fe964aa052742a2] Merge tag 'soc-5.16' of git://git.kernel.org/pub/scm/linux/kernel/git/soc/soc

testing commit 2219b0ceefe835b92a8a74a73fe964aa052742a2 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 4337c706b716f1eb46f425303109e04e6ea85f208f2165ec984af69929113a28
all runs: OK
# git bisect good 2219b0ceefe835b92a8a74a73fe964aa052742a2
Bisecting: 3942 revisions left to test after this (roughly 12 steps)
[206825f50f908771934e1fba2bfc2e1f1138b36a] Merge tag 'mtd/for-5.16' of git://git.kernel.org/pub/scm/linux/kernel/git/mtd/linux

testing commit 206825f50f908771934e1fba2bfc2e1f1138b36a gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 00e9694420e86e5137c7497d981ccc5c0b19693321ce6dd9cf34b11f208d7bca
all runs: OK
# git bisect good 206825f50f908771934e1fba2bfc2e1f1138b36a
Bisecting: 1971 revisions left to test after this (roughly 11 steps)
[4e1fddc98d2585ddd4792b5e44433dcee7ece001] tcp_cubic: fix spurious Hystart ACK train detections for not-cwnd-limited flows

testing commit 4e1fddc98d2585ddd4792b5e44433dcee7ece001 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 780b23aacd37dbb54426c43051d8e2109d1d71886cd5ace0e773e4abf6b13159
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #3: crashed: INFO: task hung in rfkill_unregister
run #4: crashed: INFO: task hung in rfkill_unregister
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
# git bisect bad 4e1fddc98d2585ddd4792b5e44433dcee7ece001
Bisecting: 989 revisions left to test after this (roughly 10 steps)
[dbf49896187fd58c577fa1574a338e4f3672b4b2] Merge branch 'akpm' (patches from Andrew)

testing commit dbf49896187fd58c577fa1574a338e4f3672b4b2 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 331483d6ebdaddd8dfab66ff9d7b6e727a4643d4887ab00fd6f887028b85dc8c
all runs: OK
# git bisect good dbf49896187fd58c577fa1574a338e4f3672b4b2
Bisecting: 492 revisions left to test after this (roughly 9 steps)
[0ecca62beb12eeb13965ed602905c8bf53ac93d0] Merge tag 'ceph-for-5.16-rc1' of git://github.com/ceph/ceph-client

testing commit 0ecca62beb12eeb13965ed602905c8bf53ac93d0 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 4b70856a4f23819df259cd034e60f6d611008671b6a8ab268b09d1b9cafa17fd
all runs: OK
# git bisect good 0ecca62beb12eeb13965ed602905c8bf53ac93d0
Bisecting: 249 revisions left to test after this (roughly 8 steps)
[7d5775d49e4a488bc8a07e5abb2b71a4c28aadbb] Merge tag 'printk-for-5.16-fixup' of git://git.kernel.org/pub/scm/linux/kernel/git/printk/linux

testing commit 7d5775d49e4a488bc8a07e5abb2b71a4c28aadbb gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 02c5d4243bdd6d7cce81fcac52a7da118537417f85fa9c77694946114cf97880
all runs: OK
# git bisect good 7d5775d49e4a488bc8a07e5abb2b71a4c28aadbb
Bisecting: 144 revisions left to test after this (roughly 7 steps)
[c7521d3aa2fa7fc785682758c99b5bcae503f6be] ptp: ocp: Fix a couple NULL vs IS_ERR() checks

testing commit c7521d3aa2fa7fc785682758c99b5bcae503f6be gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: ffcca9440d2cd69cac81cd4a53f0da40c6b237d9ed244697325a3a1df17f8605
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in misc_open
run #2: crashed: INFO: task hung in rfkill_sync_work
run #3: crashed: INFO: task hung in misc_open
run #4: crashed: INFO: task hung in misc_open
run #5: crashed: INFO: task hung in misc_open
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
# git bisect bad c7521d3aa2fa7fc785682758c99b5bcae503f6be
Bisecting: 53 revisions left to test after this (roughly 6 steps)
[f083ec3160325b6eb32907279bf2960566c2b585] Merge https://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf

testing commit f083ec3160325b6eb32907279bf2960566c2b585 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 39310c968af1685af1d607526365768ec4b7f157e2f2384939003399948cd7d4
all runs: OK
# git bisect good f083ec3160325b6eb32907279bf2960566c2b585
Bisecting: 24 revisions left to test after this (roughly 5 steps)
[9311ccef2782488ab58676c8282f9f71d01cebf5] Merge tag 'mlx5-fixes-2021-11-16' of git://git.kernel.org/pub/scm/linux/kernel/git/saeed/linux

testing commit 9311ccef2782488ab58676c8282f9f71d01cebf5 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: c8e84cc50f24e4acff2b0765c74eaffecc102fe8541ad368a30b93416009c4a1
all runs: OK
# git bisect good 9311ccef2782488ab58676c8282f9f71d01cebf5
Bisecting: 12 revisions left to test after this (roughly 4 steps)
[fec1faf221f61118aa52f44c65a13c3e173a64c2] devlink: Don't throw an error if flash notification sent before devlink visible

testing commit fec1faf221f61118aa52f44c65a13c3e173a64c2 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 787cf84a847054fa4ea3f51c1d2b1f678c8058a2695d6953d9e59086a691688e
run #0: crashed: INFO: task hung in rfkill_register
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #3: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #4: crashed: INFO: task hung in misc_open
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_register
run #8: crashed: INFO: task hung in rfkill_unregister
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
# git bisect bad fec1faf221f61118aa52f44c65a13c3e173a64c2
Bisecting: 5 revisions left to test after this (roughly 3 steps)
[86cdf8e38792545161dbe3350a7eced558ba4d15] NFC: reorganize the functions in nci_request

testing commit 86cdf8e38792545161dbe3350a7eced558ba4d15 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: 556ca467f4d4da984e9db218ec8525d1267938e99b728b4f90f9659f40918193
all runs: OK
# git bisect good 86cdf8e38792545161dbe3350a7eced558ba4d15
Bisecting: 2 revisions left to test after this (roughly 2 steps)
[a280ef90af01dc133d0a52387e563015686d6294] octeontx2-af: debugfs: don't corrupt user memory

testing commit a280ef90af01dc133d0a52387e563015686d6294 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: a1e448e8633bfce5f9202b1006d6440a7c25fcd76b1e1324721b147bfa59afa0
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_register
run #2: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #3: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #4: crashed: INFO: task hung in rfkill_unregister
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_sync_work
run #8: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
# git bisect bad a280ef90af01dc133d0a52387e563015686d6294
Bisecting: 0 revisions left to test after this (roughly 1 step)
[48b71a9e66c2eab60564b1b1c85f4928ed04e406] NFC: add NCI_UNREG flag to eliminate the race

testing commit 48b71a9e66c2eab60564b1b1c85f4928ed04e406 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: a1e448e8633bfce5f9202b1006d6440a7c25fcd76b1e1324721b147bfa59afa0
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_sync_work
run #2: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #3: crashed: INFO: task hung in rfkill_sync_work
run #4: crashed: INFO: task hung in rfkill_fop_open
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in misc_open
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
# git bisect bad 48b71a9e66c2eab60564b1b1c85f4928ed04e406
Bisecting: 0 revisions left to test after this (roughly 0 steps)
[3e3b5dfcd16a3e254aab61bd1e8c417dd4503102] NFC: reorder the logic in nfc_{un,}register_device

testing commit 3e3b5dfcd16a3e254aab61bd1e8c417dd4503102 gcc
compiler: gcc (Debian 10.2.1-6) 10.2.1 20210110, GNU ld (GNU Binutils for Debian) 2.35.2
kernel signature: c3f5379f0d9668c0ff8efb25e430c3511750feedbd01221cc719126028e72148
run #0: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #1: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #2: crashed: INFO: task hung in misc_open
run #3: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #4: crashed: INFO: task hung in rfkill_fop_open
run #5: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #6: crashed: INFO: task hung in misc_open
run #7: crashed: INFO: task hung in rfkill_global_led_trigger_worker
run #8: crashed: INFO: task hung in rfkill_sync_work
run #9: crashed: INFO: task hung in rfkill_global_led_trigger_worker
# git bisect bad 3e3b5dfcd16a3e254aab61bd1e8c417dd4503102
3e3b5dfcd16a3e254aab61bd1e8c417dd4503102 is the first bad commit
commit 3e3b5dfcd16a3e254aab61bd1e8c417dd4503102
Author: Lin Ma <linma@zju.edu.cn>
Date:   Tue Nov 16 23:26:52 2021 +0800

    NFC: reorder the logic in nfc_{un,}register_device
    
    There is a potential UAF between the unregistration routine and the NFC
    netlink operations.
    
    The race that cause that UAF can be shown as below:
    
     (FREE)                      |  (USE)
    nfcmrvl_nci_unregister_dev   |  nfc_genl_dev_up
      nci_close_device           |
      nci_unregister_device      |    nfc_get_device
        nfc_unregister_device    |    nfc_dev_up
          rfkill_destory         |
          device_del             |      rfkill_blocked
      ...                        |    ...
    
    The root cause for this race is concluded below:
    1. The rfkill_blocked (USE) in nfc_dev_up is supposed to be placed after
    the device_is_registered check.
    2. Since the netlink operations are possible just after the device_add
    in nfc_register_device, the nfc_dev_up() can happen anywhere during the
    rfkill creation process, which leads to data race.
    
    This patch reorder these actions to permit
    1. Once device_del is finished, the nfc_dev_up cannot dereference the
    rfkill object.
    2. The rfkill_register need to be placed after the device_add of nfc_dev
    because the parent device need to be created first. So this patch keeps
    the order but inject device_lock to prevent the data race.
    
    Signed-off-by: Lin Ma <linma@zju.edu.cn>
    Fixes: be055b2f89b5 ("NFC: RFKILL support")
    Reviewed-by: Jakub Kicinski <kuba@kernel.org>
    Reviewed-by: Krzysztof Kozlowski <krzysztof.kozlowski@canonical.com>
    Link: https://lore.kernel.org/r/20211116152652.19217-1-linma@zju.edu.cn
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>

 net/nfc/core.c | 32 ++++++++++++++++++--------------
 1 file changed, 18 insertions(+), 14 deletions(-)

culprit signature: c3f5379f0d9668c0ff8efb25e430c3511750feedbd01221cc719126028e72148
parent  signature: 556ca467f4d4da984e9db218ec8525d1267938e99b728b4f90f9659f40918193
revisions tested: 22, total time: 5h29m58.025269697s (build: 2h31m15.512657179s, test: 2h54m25.669841842s)
first bad commit: 3e3b5dfcd16a3e254aab61bd1e8c417dd4503102 NFC: reorder the logic in nfc_{un,}register_device
recipients (to): ["krzysztof.kozlowski@canonical.com" "kuba@kernel.org" "linma@zju.edu.cn"]
recipients (cc): []
crash: INFO: task hung in rfkill_global_led_trigger_worker
INFO: task kworker/1:4:3624 blocked for more than 143 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:kworker/1:4     state:D stack:24896 pid: 3624 ppid:     2 flags:0x00004000
Workqueue: events rfkill_global_led_trigger_worker
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 rfkill_global_led_trigger_worker+0x10/0xf0 net/rfkill/core.c:180
 process_one_work+0x87f/0x1450 kernel/workqueue.c:2298
 worker_thread+0x598/0x1040 kernel/workqueue.c:2445
 kthread+0x3ab/0x480 kernel/kthread.c:327
 ret_from_fork+0x1f/0x30 arch/x86/entry/entry_64.S:295
 </TASK>
INFO: task syz-executor.4:4079 blocked for more than 143 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.4  state:D stack:24024 pid: 4079 ppid:     1 flags:0x20000004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 misc_open+0x50/0x410 drivers/char/misc.c:107
 chrdev_open+0x20f/0x650 fs/char_dev.c:414
 do_dentry_open+0x429/0x1040 fs/open.c:822
 do_open fs/namei.c:3426 [inline]
 path_openat+0x9f8/0x22a0 fs/namei.c:3559
 do_filp_open+0x199/0x3d0 fs/namei.c:3586
 do_sys_openat2+0x11e/0x400 fs/open.c:1212
 do_sys_open fs/open.c:1228 [inline]
 __do_compat_sys_openat fs/open.c:1288 [inline]
 __se_compat_sys_openat fs/open.c:1286 [inline]
 __ia32_compat_sys_openat+0x11a/0x1d0 fs/open.c:1286
 do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]
 __do_fast_syscall_32+0x65/0xf0 arch/x86/entry/common.c:178
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf7463549
RSP: 002b:00000000ffe8bab0 EFLAGS: 00000286 ORIG_RAX: 0000000000000127
RAX: ffffffffffffffda RBX: 00000000ffffff9c RCX: 00000000f73a76c4
RDX: 0000000000000002 RSI: 0000000000000000 RDI: 00000000f7452000
RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>
INFO: task syz-executor.0:4080 blocked for more than 143 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.0  state:D stack:23328 pid: 4080 ppid:     1 flags:0x20000004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 rfkill_fop_open+0xee/0x6c0 net/rfkill/core.c:1148
 misc_open+0x2f0/0x410 drivers/char/misc.c:141
 chrdev_open+0x20f/0x650 fs/char_dev.c:414
 do_dentry_open+0x429/0x1040 fs/open.c:822
 do_open fs/namei.c:3426 [inline]
 path_openat+0x9f8/0x22a0 fs/namei.c:3559
 do_filp_open+0x199/0x3d0 fs/namei.c:3586
 do_sys_openat2+0x11e/0x400 fs/open.c:1212
 do_sys_open fs/open.c:1228 [inline]
 __do_compat_sys_openat fs/open.c:1288 [inline]
 __se_compat_sys_openat fs/open.c:1286 [inline]
 __ia32_compat_sys_openat+0x11a/0x1d0 fs/open.c:1286
 do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]
 __do_fast_syscall_32+0x65/0xf0 arch/x86/entry/common.c:178
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf741a549
RSP: 002b:00000000fff71530 EFLAGS: 00000282 ORIG_RAX: 0000000000000127
RAX: ffffffffffffffda RBX: 00000000ffffff9c RCX: 00000000f735e6c4
RDX: 0000000000000002 RSI: 0000000000000000 RDI: 00000000f7409000
RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>
INFO: task syz-executor.3:4081 blocked for more than 144 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.3  state:D stack:24024 pid: 4081 ppid:     1 flags:0x20000004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 misc_open+0x50/0x410 drivers/char/misc.c:107
 chrdev_open+0x20f/0x650 fs/char_dev.c:414
 do_dentry_open+0x429/0x1040 fs/open.c:822
 do_open fs/namei.c:3426 [inline]
 path_openat+0x9f8/0x22a0 fs/namei.c:3559
 do_filp_open+0x199/0x3d0 fs/namei.c:3586
 do_sys_openat2+0x11e/0x400 fs/open.c:1212
 do_sys_open fs/open.c:1228 [inline]
 __do_compat_sys_openat fs/open.c:1288 [inline]
 __se_compat_sys_openat fs/open.c:1286 [inline]
 __ia32_compat_sys_openat+0x11a/0x1d0 fs/open.c:1286
 do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]
 __do_fast_syscall_32+0x65/0xf0 arch/x86/entry/common.c:178
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf73d0549
RSP: 002b:00000000fff85cd0 EFLAGS: 00000286 ORIG_RAX: 0000000000000127
RAX: ffffffffffffffda RBX: 00000000ffffff9c RCX: 00000000f73146c4
RDX: 0000000000000002 RSI: 0000000000000000 RDI: 00000000f73bf000
RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>
INFO: task syz-executor.1:4087 blocked for more than 144 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.1  state:D stack:23664 pid: 4087 ppid:     1 flags:0x20004004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 misc_open+0x50/0x410 drivers/char/misc.c:107
 chrdev_open+0x20f/0x650 fs/char_dev.c:414
 do_dentry_open+0x429/0x1040 fs/open.c:822
 do_open fs/namei.c:3426 [inline]
 path_openat+0x9f8/0x22a0 fs/namei.c:3559
 do_filp_open+0x199/0x3d0 fs/namei.c:3586
 do_sys_openat2+0x11e/0x400 fs/open.c:1212
 do_sys_open fs/open.c:1228 [inline]
 __do_compat_sys_openat fs/open.c:1288 [inline]
 __se_compat_sys_openat fs/open.c:1286 [inline]
 __ia32_compat_sys_openat+0x11a/0x1d0 fs/open.c:1286
 do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]
 __do_fast_syscall_32+0x65/0xf0 arch/x86/entry/common.c:178
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf749b549
RSP: 002b:00000000ff881080 EFLAGS: 00000286 ORIG_RAX: 0000000000000127
RAX: ffffffffffffffda RBX: 00000000ffffff9c RCX: 00000000f73df6c4
RDX: 0000000000000002 RSI: 0000000000000000 RDI: 00000000f748a000
RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>
INFO: task syz-executor.5:4088 blocked for more than 144 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.5  state:D stack:24024 pid: 4088 ppid:     1 flags:0x20000004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 misc_open+0x50/0x410 drivers/char/misc.c:107
 chrdev_open+0x20f/0x650 fs/char_dev.c:414
 do_dentry_open+0x429/0x1040 fs/open.c:822
 do_open fs/namei.c:3426 [inline]
 path_openat+0x9f8/0x22a0 fs/namei.c:3559
 do_filp_open+0x199/0x3d0 fs/namei.c:3586
 do_sys_openat2+0x11e/0x400 fs/open.c:1212
 do_sys_open fs/open.c:1228 [inline]
 __do_compat_sys_openat fs/open.c:1288 [inline]
 __se_compat_sys_openat fs/open.c:1286 [inline]
 __ia32_compat_sys_openat+0x11a/0x1d0 fs/open.c:1286
 do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]
 __do_fast_syscall_32+0x65/0xf0 arch/x86/entry/common.c:178
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf7442549
RSP: 002b:00000000ff8baab0 EFLAGS: 00000286 ORIG_RAX: 0000000000000127
RAX: ffffffffffffffda RBX: 00000000ffffff9c RCX: 00000000f73866c4
RDX: 0000000000000002 RSI: 0000000000000000 RDI: 00000000f7431000
RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>
INFO: task syz-executor.2:4276 blocked for more than 145 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.2  state:D stack:28144 pid: 4276 ppid:  4077 flags:0x20004004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 rfkill_unregister+0xc6/0x290 net/rfkill/core.c:1117
 nfc_unregister_device+0x69/0x2b0 net/nfc/core.c:1166
 virtual_ncidev_close+0x53/0x70 drivers/nfc/virtual_ncidev.c:163
 __fput+0x204/0x8d0 fs/file_table.c:280
 task_work_run+0xc0/0x160 kernel/task_work.c:164
 tracehook_notify_resume include/linux/tracehook.h:189 [inline]
 exit_to_user_mode_loop kernel/entry/common.c:175 [inline]
 exit_to_user_mode_prepare+0x27e/0x290 kernel/entry/common.c:207
 __syscall_exit_to_user_mode_work kernel/entry/common.c:289 [inline]
 syscall_exit_to_user_mode+0x19/0x60 kernel/entry/common.c:300
 __do_fast_syscall_32+0x72/0xf0 arch/x86/entry/common.c:181
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf73e6549
RSP: 002b:00000000fff35ed0 EFLAGS: 00000286 ORIG_RAX: 0000000000000006
RAX: 0000000000000000 RBX: 0000000000000003 RCX: 0000000000000002
RDX: 0000000000000000 RSI: 00000000f73d5000 RDI: 00000000000128f3
RBP: 00000000f74040c0 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>
INFO: task syz-executor.2:4277 blocked for more than 145 seconds.
      Not tainted 5.15.0-syzkaller #0
"echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
task:syz-executor.2  state:D stack:26240 pid: 4277 ppid:  4077 flags:0x20004004
Call Trace:
 <TASK>
 context_switch kernel/sched/core.c:4969 [inline]
 __schedule+0xa5a/0x48f0 kernel/sched/core.c:6250
 schedule+0xd2/0x260 kernel/sched/core.c:6323
 schedule_preempt_disabled+0xf/0x20 kernel/sched/core.c:6382
 __mutex_lock_common kernel/locking/mutex.c:680 [inline]
 __mutex_lock+0xa32/0x12f0 kernel/locking/mutex.c:740
 device_lock include/linux/device.h:760 [inline]
 nfc_dev_down+0x1f/0x270 net/nfc/core.c:143
 nfc_rfkill_set_block+0x15/0x90 net/nfc/core.c:179
 rfkill_set_block+0x191/0x440 net/rfkill/core.c:344
 rfkill_fop_write+0x1c7/0x3f0 net/rfkill/core.c:1268
 vfs_write+0x1c4/0x900 fs/read_write.c:588
 ksys_write+0x171/0x1d0 fs/read_write.c:643
 do_syscall_32_irqs_on arch/x86/entry/common.c:112 [inline]
 __do_fast_syscall_32+0x65/0xf0 arch/x86/entry/common.c:178
 do_fast_syscall_32+0x2f/0x70 arch/x86/entry/common.c:203
 entry_SYSENTER_compat_after_hwframe+0x4d/0x5c
RIP: 0023:0xf73e6549
RSP: 002b:00000000f66865cc EFLAGS: 00000296 ORIG_RAX: 0000000000000004
RAX: ffffffffffffffda RBX: 0000000000000004 RCX: 0000000020000080
RDX: 0000000000000008 RSI: 0000000000000000 RDI: 0000000000000000
RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000
 </TASK>

Showing all locks held in the system:
1 lock held by khungtaskd/27:
 #0: ffffffff8b17ca80 (rcu_read_lock){....}-{1:2}, at: debug_show_all_locks+0x53/0x260 kernel/locking/lockdep.c:6458
2 locks held by getty/3291:
 #0: ffff88802300e098 (&tty->ldisc_sem){++++}-{0:0}, at: tty_ldisc_ref_wait+0x1f/0x70 drivers/tty/tty_ldisc.c:252
 #1: ffffc900027a32e8 (&ldata->atomic_read_lock){+.+.}-{3:3}, at: n_tty_read+0x9e1/0xee0 drivers/tty/n_tty.c:2113
3 locks held by kworker/1:4/3624:
 #0: ffff888010c64d38 ((wq_completion)events){+.+.}-{0:0}, at: arch_atomic64_set arch/x86/include/asm/atomic64_64.h:34 [inline]
 #0: ffff888010c64d38 ((wq_completion)events){+.+.}-{0:0}, at: arch_atomic_long_set include/linux/atomic/atomic-long.h:41 [inline]
 #0: ffff888010c64d38 ((wq_completion)events){+.+.}-{0:0}, at: atomic_long_set include/linux/atomic/atomic-instrumented.h:1198 [inline]
 #0: ffff888010c64d38 ((wq_completion)events){+.+.}-{0:0}, at: set_work_data kernel/workqueue.c:635 [inline]
 #0: ffff888010c64d38 ((wq_completion)events){+.+.}-{0:0}, at: set_work_pool_and_clear_pending kernel/workqueue.c:662 [inline]
 #0: ffff888010c64d38 ((wq_completion)events){+.+.}-{0:0}, at: process_one_work+0x7a4/0x1450 kernel/workqueue.c:2269
 #1: ffffc900024dfdb8 ((work_completion)(&rfkill_global_led_trigger_work)){+.+.}-{0:0}, at: process_one_work+0x7d1/0x1450 kernel/workqueue.c:2273
 #2: ffffffff8ccb1e08 (rfkill_global_mutex){+.+.}-{3:3}, at: rfkill_global_led_trigger_worker+0x10/0xf0 net/rfkill/core.c:180
1 lock held by syz-executor.4/4079:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
2 locks held by syz-executor.0/4080:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
 #1: ffffffff8ccb1e08 (rfkill_global_mutex){+.+.}-{3:3}, at: rfkill_fop_open+0xee/0x6c0 net/rfkill/core.c:1148
1 lock held by syz-executor.3/4081:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.1/4087:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.5/4088:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
2 locks held by syz-executor.2/4276:
 #0: ffff88807b994190 (&dev->mutex){....}-{3:3}, at: device_lock include/linux/device.h:760 [inline]
 #0: ffff88807b994190 (&dev->mutex){....}-{3:3}, at: nfc_unregister_device+0x3d/0x2b0 net/nfc/core.c:1164
 #1: ffffffff8ccb1e08 (rfkill_global_mutex){+.+.}-{3:3}, at: rfkill_unregister+0xc6/0x290 net/rfkill/core.c:1117
2 locks held by syz-executor.2/4277:
 #0: ffffffff8ccb1e08 (rfkill_global_mutex){+.+.}-{3:3}, at: rfkill_fop_write+0xb9/0x3f0 net/rfkill/core.c:1260
 #1: ffff88807b994190 (&dev->mutex){....}-{3:3}, at: device_lock include/linux/device.h:760 [inline]
 #1: ffff88807b994190 (&dev->mutex){....}-{3:3}, at: nfc_dev_down+0x1f/0x270 net/nfc/core.c:143
1 lock held by syz-executor.2/4959:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.4/4965:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.3/4966:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.0/4967:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.1/4968:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.5/4969:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.2/4972:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.3/4976:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.4/4979:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.1/4980:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.5/4981:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107
1 lock held by syz-executor.0/4982:
 #0: ffffffff8bb923a8 (misc_mtx){+.+.}-{3:3}, at: misc_open+0x50/0x410 drivers/char/misc.c:107

=============================================

NMI backtrace for cpu 1
CPU: 1 PID: 27 Comm: khungtaskd Not tainted 5.15.0-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/12/2023
Call Trace:
 <TASK>
 __dump_stack lib/dump_stack.c:88 [inline]
 dump_stack_lvl+0x57/0x7d lib/dump_stack.c:106
 nmi_cpu_backtrace.cold+0x30/0xc0 lib/nmi_backtrace.c:105
 nmi_trigger_cpumask_backtrace+0x11a/0x160 lib/nmi_backtrace.c:62
 trigger_all_cpu_backtrace include/linux/nmi.h:146 [inline]
 check_hung_uninterruptible_tasks kernel/hung_task.c:210 [inline]
 watchdog+0x88c/0xbf0 kernel/hung_task.c:295
 kthread+0x3ab/0x480 kernel/kthread.c:327
 ret_from_fork+0x1f/0x30 arch/x86/entry/entry_64.S:295
 </TASK>
Sending NMI from CPU 1 to CPUs 0:
NMI backtrace for cpu 0
CPU: 0 PID: 9 Comm: kworker/u4:1 Not tainted 5.15.0-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/12/2023
Workqueue: events_unbound toggle_allocation_gate
RIP: 0010:check_wait_context kernel/locking/lockdep.c:4725 [inline]
RIP: 0010:__lock_acquire+0x64f/0x54a0 kernel/locking/lockdep.c:4977
Code: ff df 48 c1 e8 03 4c 8b 74 24 28 4c 01 f8 48 89 44 24 60 eb 66 48 8d 04 5b 48 c1 e0 06 48 05 a0 0e b8 8f 48 8d b8 b8 00 00 00 <48> 89 fa 48 c1 ea 03 42 0f b6 14 3a 84 d2 74 06 0f 8e 5f 2b 00 00
RSP: 0018:ffffc90000ce77d8 EFLAGS: 00000082
RAX: ffffffff8fb813e0 RBX: 0000000000000007 RCX: ffffffff8154846d
RDX: fffffbfff1f70151 RSI: 0000000000000008 RDI: ffffffff8fb81498
RBP: 0000000000000004 R08: 0000000000000000 R09: ffffffff8fb80a87
R10: fffffbfff1f70150 R11: 0000000000000000 R12: 0000000000000002
R13: ffff888010e80000 R14: ffff888010e80a60 R15: dffffc0000000000
FS:  0000000000000000(0000) GS:ffff8880b9c00000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f54b69e0990 CR3: 000000000ae8e000 CR4: 00000000003506f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
 <TASK>
 lock_acquire kernel/locking/lockdep.c:5637 [inline]
 lock_acquire+0x1ab/0x510 kernel/locking/lockdep.c:5602
 __raw_spin_lock include/linux/spinlock_api_smp.h:133 [inline]
 _raw_spin_lock+0x2a/0x40 kernel/locking/spinlock.c:154
 spin_lock include/linux/spinlock.h:349 [inline]
 __get_locked_pte+0x203/0x3c0 mm/memory.c:1722
 get_locked_pte include/linux/mm.h:2160 [inline]
 __text_poke+0x1ae/0x8c0 arch/x86/kernel/alternative.c:1000
 text_poke_bp_batch+0x2eb/0x560 arch/x86/kernel/alternative.c:1310
 text_poke_flush arch/x86/kernel/alternative.c:1451 [inline]
 text_poke_flush arch/x86/kernel/alternative.c:1448 [inline]
 text_poke_finish+0x16/0x30 arch/x86/kernel/alternative.c:1458
 arch_jump_label_transform_apply+0x13/0x20 arch/x86/kernel/jump_label.c:146
 static_key_disable_cpuslocked+0x100/0x160 kernel/jump_label.c:207
 static_key_disable+0x11/0x20 kernel/jump_label.c:215
 toggle_allocation_gate mm/kfence/core.c:746 [inline]
 toggle_allocation_gate+0x154/0x310 mm/kfence/core.c:724
 process_one_work+0x87f/0x1450 kernel/workqueue.c:2298
 worker_thread+0x598/0x1040 kernel/workqueue.c:2445
 kthread+0x3ab/0x480 kernel/kthread.c:327
 ret_from_fork+0x1f/0x30 arch/x86/entry/entry_64.S:295
 </TASK>

