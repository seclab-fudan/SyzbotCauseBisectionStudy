bisecting cause commit starting from ba31f97d43be41ca99ab72a6131d7c226306865f
building syzkaller on 2489ab887a86e8b1b253aef742e365a606db3a4f
testing commit ba31f97d43be41ca99ab72a6131d7c226306865f
compiler: gcc (GCC) 10.2.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: def82cb7d2fd0966edc9835910b40f008c48d286f29d52ca18b1cafc7b6e8c3c
run #0: crashed: INFO: task hung in paste_selection
run #1: crashed: INFO: task hung in paste_selection
run #2: crashed: INFO: task hung in paste_selection
run #3: crashed: INFO: task hung in paste_selection
run #4: crashed: INFO: task hung in paste_selection
run #5: crashed: INFO: task hung in paste_selection
run #6: crashed: INFO: task hung in paste_selection
run #7: crashed: INFO: task hung in paste_selection
run #8: crashed: INFO: task hung in paste_selection
run #9: crashed: INFO: task hung in paste_selection
run #10: crashed: INFO: task hung in paste_selection
run #11: crashed: INFO: task hung in paste_selection
run #12: crashed: INFO: task hung in paste_selection
run #13: crashed: INFO: task hung in paste_selection
run #14: crashed: INFO: task hung in paste_selection
run #15: crashed: INFO: task hung in tty_ldisc_hangup
run #16: crashed: INFO: task hung in tty_ldisc_hangup
run #17: crashed: INFO: task hung in tty_ldisc_hangup
run #18: OK
run #19: crashed: INFO: task hung in tty_ldisc_hangup
testing release v5.13
testing commit 62fb9874f5da54fdb243003b386128037319b219
compiler: gcc (GCC) 10.2.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: eaab50170f966c8b3eb39852b91e95d9bc7e454d96827a490e5a435720d1ffbe
run #0: crashed: INFO: task hung in paste_selection
run #1: crashed: INFO: task hung in paste_selection
run #2: crashed: INFO: task hung in paste_selection
run #3: crashed: INFO: task hung in paste_selection
run #4: crashed: INFO: task hung in tty_ldisc_hangup
run #5: crashed: INFO: task hung in paste_selection
run #6: crashed: INFO: task hung in paste_selection
run #7: crashed: INFO: task hung in paste_selection
run #8: crashed: INFO: task hung in paste_selection
run #9: crashed: INFO: task hung in paste_selection
testing release v5.12
testing commit 9f4ad9e425a1d3b6a34617b8ea226d56a119a717
compiler: gcc (GCC) 10.2.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: a2c67d0aa4cd9031fb2dccc0e9429d13c38be324308c26aa1ef6b084265ddb79
run #0: crashed: INFO: task hung in paste_selection
run #1: crashed: INFO: task hung in paste_selection
run #2: crashed: INFO: task hung in paste_selection
run #3: crashed: INFO: task hung in paste_selection
run #4: crashed: INFO: task hung in paste_selection
run #5: crashed: INFO: task hung in paste_selection
run #6: crashed: INFO: task hung in paste_selection
run #7: crashed: INFO: task hung in paste_selection
run #8: crashed: INFO: task hung in tty_ldisc_hangup
run #9: crashed: INFO: task hung in paste_selection
testing release v5.11
testing commit f40ddce88593482919761f74910f42f4b84c004b
compiler: gcc (GCC) 10.2.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: 760afc9eb3d03287b34ea942b7a411382f5645571be3e022de43df2d69784b74
all runs: crashed: INFO: task hung in paste_selection
testing release v5.10
testing commit 2c85ebc57b3e1817b6ce1a6b703928e113a90442
compiler: gcc (GCC) 10.2.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: ed87a01106570e960457a093defc61da2463f8df499a22d92a19e05b34bca040
run #0: crashed: INFO: task hung in paste_selection
run #1: crashed: INFO: task hung in paste_selection
run #2: crashed: INFO: task hung in paste_selection
run #3: crashed: INFO: task hung in paste_selection
run #4: crashed: INFO: task hung in paste_selection
run #5: crashed: INFO: task hung in paste_selection
run #6: crashed: INFO: task hung in paste_selection
run #7: crashed: INFO: task hung in paste_selection
run #8: crashed: INFO: task hung in tty_ldisc_hangup
run #9: crashed: INFO: task hung in paste_selection
testing release v5.9
testing commit bbf5c979011a099af5dc76498918ed7df445635b
compiler: gcc (GCC) 10.2.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: a6ff38e82dd9e7b72f8594f21d4456e9f130fed2d0baffe8f9a1ac831a8846b8
run #0: crashed: INFO: task hung in paste_selection
run #1: crashed: INFO: task hung in paste_selection
run #2: crashed: INFO: task hung in paste_selection
run #3: crashed: INFO: task hung in tty_ldisc_hangup
run #4: crashed: INFO: task hung in paste_selection
run #5: crashed: INFO: task hung in tty_ldisc_hangup
run #6: crashed: INFO: task hung in paste_selection
run #7: crashed: INFO: task hung in paste_selection
run #8: crashed: INFO: task hung in tty_ldisc_hangup
run #9: crashed: INFO: task hung in tty_ldisc_hangup
testing release v5.8
testing commit bcf876870b95592b52519ed4aafcf9d95999bc9c
compiler: gcc (GCC) 8.4.1 20210217, GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: 148af9454d2419d8c534f359dc0ada77e2a0b73e26499bd1d569517b33bb77e1
run #0: crashed: INFO: task hung in paste_selection
run #1: crashed: INFO: task hung in paste_selection
run #2: crashed: INFO: task hung in paste_selection
run #3: crashed: INFO: task hung in paste_selection
run #4: crashed: INFO: task hung in paste_selection
run #5: crashed: INFO: task hung in paste_selection
run #6: crashed: INFO: task hung in paste_selection
run #7: crashed: INFO: task hung in paste_selection
run #8: crashed: INFO: task hung in tty_ldisc_hangup
run #9: crashed: INFO: task hung in tty_ldisc_hangup
testing release v5.7
testing commit 3d77e6a8804abcc0504c904bd6e5cdf3a5cf8162
compiler: gcc version 8.4.1 20210217 (GCC), GNU ld (GNU Binutils for Debian) 2.35.1
kernel signature: c39813ac1b4cf9ee17cd9581d29834c9312d7a9e2d37c5149682cd29e326d445
all runs: crashed: INFO: task hung in paste_selection
testing release v5.6
testing commit 7111951b8d4973bda27ff663f2cf18b663d15b48
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 65e9f41c1707ffe281e68adea77024db743fc3aec52e15a3092851b775aa1091
all runs: crashed: INFO: task hung in paste_selection
testing release v5.5
testing commit d5226fa6dbae0569ee43ecfc08bdcd6770fc4755
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: df229a265ef77d7ea04c00e82025c3f1c0476396510a270bc6ec4e905f5dd17e
run #0: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #1: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #2: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #3: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #4: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #5: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #6: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #7: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #8: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #9: crashed: INFO: task hung in paste_selection
testing release v5.4
testing commit 219d54332a09e8d8741c1e1982f5eae56099de85
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 4db262e20e001154554aacba8ee069cf005e1d0d472bd35a6ff08601ed7ef2f2
all runs: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
testing release v5.3
testing commit 4d856f72c10ecb060868ed10ff1b1453943fc6c8
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 8a03cb69477372e7c3f6c0fee23e5ea1b68880d5ca37439f59113cf3c4eda96e
run #0: crashed: KASAN: slab-out-of-bounds Read in n_tty_receive_buf_common
run #1: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #2: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #3: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #4: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #5: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #6: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #7: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #8: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #9: crashed: INFO: task hung in paste_selection
testing release v5.2
testing commit 0ecfebd2b52404ae0c54a878c872bb93363ada36
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: a63def1637c68d4b2393eca6fa64f291c241df7444f98d045fce92c45e3140a6
run #0: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #1: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #2: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #3: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #4: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #5: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #6: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #7: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #8: crashed: INFO: task hung in paste_selection
run #9: crashed: INFO: task hung in paste_selection
testing release v5.1
testing commit e93c9c99a629c61837d5a7fc2120cd2b6c70dbdd
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: f8efdfe78b77cd25d04aab4225a16b81c92c36c009eef26f6201701b40898542
all runs: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
testing release v5.0
testing commit 1c163f4c7b3f621efff9b28a47abb36f7378d783
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 8febb2553a8c0a5b6ddbcecc9d82d1b651fdece6c7b63653a085e30edb3aa2ec
run #0: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #1: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #2: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #3: crashed: KASAN: out-of-bounds Read in n_tty_receive_buf_common
run #4: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #5: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #6: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #7: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #8: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
run #9: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
testing release v4.20
testing commit 8fe28cb58bcb235034b64cbbb7550a8a43fd88be
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 954799414a6036da84afe11b5f8db5b0d01028e5dbf5efa0eb6e233adbaa6b1a
all runs: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
testing release v4.19
testing commit 84df9525b0c27f3ebc2ebb1864fa62a97fdedb7d
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 45e2093ea9cc4d0f4694a54c77160f7d5b08d933d16bbddcf1d1ff420be2ca65
all runs: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
testing release v4.18
testing commit 94710cac0ef4ee177a63b5227664b38c95bbf703
compiler: gcc version 8.4.1 20210217 (GCC)
kernel signature: 725b638e01e065708a30cb827fab020f6d0492c961de327e4436b029d204ace1
all runs: crashed: KASAN: use-after-free Read in n_tty_receive_buf_common
testing release v4.17
testing commit 29dcea88779c856c7dc92040a0c01233263101d4
failed to run ["make" "-j" "64" "ARCH=x86_64" "CC=/syzkaller/shared/bisect_bin/gcc-8.1.0/bin/gcc" "bzImage"]: exit status 2
testing release v4.16
testing commit 0adb32858b0bddf4ada5f364a84ed60b196dbcda
orc_dump.c:106:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
orc_dump.c:111:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
elf.c:135:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:140:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
testing release v4.15
testing commit d8a5b80568a9cb66810e75b182018e9edb68e8ff
orc_dump.c:106:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
orc_dump.c:111:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:36:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
elf.c:135:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:140:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
testing release v4.14
testing commit bebc6082da0a9f5d47a1ea2edc099bf671058bd4
orc_dump.c:105:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
orc_dump.c:110:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
elf.c:134:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:139:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:36:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
testing release v4.13
testing commit 569dbb88e80deb68974ef6fdd6a13edb9d686261
pager.c:35:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
elf.c:144:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:149:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
testing release v4.12
testing commit 6f7da290413ba713f0cdd9ff1a2a9bb129ef4f6c
pager.c:35:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
elf.c:141:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:146:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
testing release v4.11
testing commit a351e9b9fc24e982ec2f0e76379a49826036da12
elf.c:141:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:146:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:35:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
testing release v4.10
testing commit c470abd4fde40ea6a0846a2beab642a578c0b8cd
tools/include/linux/log2.h:19:1: error: ignoring attribute 'noreturn' because it conflicts with attribute 'const' [-Werror=attributes]
elf.c:129:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:134:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:35:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
testing release v4.9
testing commit 69973b830859bc6529a7a0468ba0d80ee5117826
tools/include/linux/log2.h:19:1: error: ignoring attribute 'noreturn' because it conflicts with attribute 'const' [-Werror=attributes]
elf.c:129:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:134:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:35:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
testing release v4.8
testing commit c8d2bc9bc39ebea8437fd974fdbc21847bb897a3
tools/include/linux/log2.h:19:1: error: ignoring attribute 'noreturn' because it conflicts with attribute 'const' [-Werror=attributes]
elf.c:129:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:134:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:33:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
testing release v4.7
testing commit 523d939ef98fd712632d93a5a2b588e477a7565e
tools/include/linux/log2.h:19:1: error: ignoring attribute 'noreturn' because it conflicts with attribute 'const' [-Werror=attributes]
elf.c:122:2: error: 'elf_getshnum' is deprecated [-Werror=deprecated-declarations]
elf.c:127:2: error: 'elf_getshstrndx' is deprecated [-Werror=deprecated-declarations]
pager.c:33:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
testing release v4.6
testing commit 2dcd0af568b0cf583645c8a317dd12e344b1c72a
tools/include/linux/log2.h:19:1: error: ignoring attribute 'noreturn' because it conflicts with attribute 'const' [-Werror=attributes]
pager.c:33:12: error: passing argument 2 to 'restrict'-qualified parameter aliases with argument 4 [-Werror=restrict]
revisions tested: 18, total time: 3h48m32.666224604s (build: 1h56m21.426541423s, test: 1h47m28.882683004s)
the crash already happened on the oldest tested release
commit msg: Linux 4.18
crash: KASAN: use-after-free Read in n_tty_receive_buf_common
Bluetooth: hci2: command 0x0419 tx timeout
Bluetooth: hci4: command 0x0419 tx timeout
Bluetooth: hci5: command 0x0419 tx timeout
Bluetooth: hci3: command 0x0419 tx timeout
==================================================================
BUG: KASAN: use-after-free in put_tty_queue drivers/tty/n_tty.c:304 [inline]
BUG: KASAN: use-after-free in n_tty_receive_buf_standard drivers/tty/n_tty.c:1564 [inline]
BUG: KASAN: use-after-free in __receive_buf drivers/tty/n_tty.c:1631 [inline]
BUG: KASAN: use-after-free in n_tty_receive_buf_common+0x1df0/0x2e40 drivers/tty/n_tty.c:1727
Read of size 1 at addr ffff880097592101 by task syz-executor.3/10449

CPU: 1 PID: 10449 Comm: syz-executor.3 Not tainted 4.18.0-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
 __dump_stack lib/dump_stack.c:77 [inline]
 dump_stack+0x15a/0x20d lib/dump_stack.c:113
 print_address_description.cold.6+0x9/0x244 mm/kasan/report.c:256
 kasan_report_error mm/kasan/report.c:354 [inline]
 kasan_report mm/kasan/report.c:412 [inline]
 kasan_report.cold.7+0x242/0x305 mm/kasan/report.c:396
 __asan_report_load1_noabort+0x14/0x20 mm/kasan/report.c:430
 put_tty_queue drivers/tty/n_tty.c:304 [inline]
 n_tty_receive_buf_standard drivers/tty/n_tty.c:1564 [inline]
 __receive_buf drivers/tty/n_tty.c:1631 [inline]
 n_tty_receive_buf_common+0x1df0/0x2e40 drivers/tty/n_tty.c:1727
 n_tty_receive_buf2+0xf/0x20 drivers/tty/n_tty.c:1762
 tty_ldisc_receive_buf+0x86/0x1b0 drivers/tty/tty_buffer.c:456
 paste_selection+0x253/0x3e0 drivers/tty/vt/selection.c:349
 tioclinux+0x10b/0x390 drivers/tty/vt/vt.c:2693
 vt_ioctl+0x187a/0x2120 drivers/tty/vt/vt_ioctl.c:362
 tty_ioctl+0x456/0x1280 drivers/tty/tty_io.c:2655
 vfs_ioctl fs/ioctl.c:46 [inline]
 file_ioctl fs/ioctl.c:500 [inline]
 do_vfs_ioctl+0x196/0x1050 fs/ioctl.c:684
 ksys_ioctl+0x62/0x90 fs/ioctl.c:701
 __do_sys_ioctl fs/ioctl.c:708 [inline]
 __se_sys_ioctl fs/ioctl.c:706 [inline]
 __x64_sys_ioctl+0x6e/0xb0 fs/ioctl.c:706
 do_syscall_64+0xda/0x540 arch/x86/entry/common.c:290
 entry_SYSCALL_64_after_hwframe+0x49/0xbe
RIP: 0033:0x4665e9
Code: ff ff c3 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 bc ff ff ff f7 d8 64 89 01 48 
RSP: 002b:00007f72a7a58188 EFLAGS: 00000246 ORIG_RAX: 0000000000000010
RAX: ffffffffffffffda RBX: 000000000056bf80 RCX: 00000000004665e9
RDX: 00000000200000c0 RSI: 000000000000541c RDI: 0000000000000003
RBP: 00000000004bfcc4 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 000000000056bf80
R13: 00007fffb9c72c9f R14: 00007f72a7a58300 R15: 0000000000022000

Allocated by task 10498:
 save_stack mm/kasan/kasan.c:448 [inline]
 set_track mm/kasan/kasan.c:460 [inline]
 kasan_kmalloc.part.1+0x62/0xf0 mm/kasan/kasan.c:553
 kasan_kmalloc+0xaf/0xc0 mm/kasan/kasan.c:538
 __kmalloc+0x15f/0x3a0 mm/slub.c:3753
 kmalloc_array include/linux/slab.h:635 [inline]
 set_selection+0x657/0xe40 drivers/tty/vt/selection.c:283
 tioclinux+0xf6/0x390 drivers/tty/vt/vt.c:2689
 vt_ioctl+0x187a/0x2120 drivers/tty/vt/vt_ioctl.c:362
 tty_ioctl+0x456/0x1280 drivers/tty/tty_io.c:2655
 vfs_ioctl fs/ioctl.c:46 [inline]
 file_ioctl fs/ioctl.c:500 [inline]
 do_vfs_ioctl+0x196/0x1050 fs/ioctl.c:684
 ksys_ioctl+0x62/0x90 fs/ioctl.c:701
 __do_sys_ioctl fs/ioctl.c:708 [inline]
 __se_sys_ioctl fs/ioctl.c:706 [inline]
 __x64_sys_ioctl+0x6e/0xb0 fs/ioctl.c:706
 do_syscall_64+0xda/0x540 arch/x86/entry/common.c:290
 entry_SYSCALL_64_after_hwframe+0x49/0xbe

Freed by task 10505:
 save_stack mm/kasan/kasan.c:448 [inline]
 set_track mm/kasan/kasan.c:460 [inline]
 __kasan_slab_free+0x167/0x240 mm/kasan/kasan.c:521
 kasan_slab_free+0xe/0x10 mm/kasan/kasan.c:528
 slab_free_hook mm/slub.c:1373 [inline]
 slab_free_freelist_hook mm/slub.c:1400 [inline]
 slab_free mm/slub.c:2955 [inline]
 kfree+0x130/0x3b0 mm/slub.c:3908
 set_selection+0x67c/0xe40 drivers/tty/vt/selection.c:290
 tioclinux+0xf6/0x390 drivers/tty/vt/vt.c:2689
 vt_ioctl+0x187a/0x2120 drivers/tty/vt/vt_ioctl.c:362
 tty_ioctl+0x456/0x1280 drivers/tty/tty_io.c:2655
 vfs_ioctl fs/ioctl.c:46 [inline]
 file_ioctl fs/ioctl.c:500 [inline]
 do_vfs_ioctl+0x196/0x1050 fs/ioctl.c:684
 ksys_ioctl+0x62/0x90 fs/ioctl.c:701
 __do_sys_ioctl fs/ioctl.c:708 [inline]
 __se_sys_ioctl fs/ioctl.c:706 [inline]
 __x64_sys_ioctl+0x6e/0xb0 fs/ioctl.c:706
 do_syscall_64+0xda/0x540 arch/x86/entry/common.c:290
 entry_SYSCALL_64_after_hwframe+0x49/0xbe

The buggy address belongs to the object at ffff880097592100
 which belongs to the cache kmalloc-8192 of size 8192
The buggy address is located 1 bytes inside of
 8192-byte region [ffff880097592100, ffff880097594100)
The buggy address belongs to the page:
page:ffffea00025d6400 count:1 mapcount:0 mapping:ffff88013fe10400 index:0x0 compound_mapcount: 0
flags: 0xfff00000008100(slab|head)
raw: 00fff00000008100 ffffea0002caee00 0000000200000002 ffff88013fe10400
raw: 0000000000000000 0000000000030003 00000001ffffffff 0000000000000000
page dumped because: kasan: bad access detected
page allocated via order 3, migratetype Unmovable, gfp_mask 0x152c0(__GFP_IO|__GFP_FS|__GFP_NOWARN|__GFP_NORETRY|__GFP_COMP|__GFP_NOMEMALLOC)
 set_page_owner include/linux/page_owner.h:31 [inline]
 post_alloc_hook mm/page_alloc.c:1906 [inline]
 prep_new_page mm/page_alloc.c:1914 [inline]
 get_page_from_freelist+0x2f35/0x46b0 mm/page_alloc.c:3345
 __alloc_pages_nodemask+0x39e/0x2780 mm/page_alloc.c:4369
 alloc_pages_current+0xd6/0x1b0 mm/mempolicy.c:2093
 alloc_pages include/linux/gfp.h:492 [inline]
 alloc_slab_page mm/slub.c:1440 [inline]
 allocate_slab mm/slub.c:1585 [inline]
 new_slab+0x4a9/0x850 mm/slub.c:1656
 new_slab_objects mm/slub.c:2419 [inline]
 ___slab_alloc+0x609/0x940 mm/slub.c:2571
 __slab_alloc.isra.22+0x78/0xe0 mm/slub.c:2611
 slab_alloc_node mm/slub.c:2674 [inline]
 slab_alloc mm/slub.c:2716 [inline]
 __kmalloc_track_caller+0x288/0x360 mm/slub.c:4292
 kmemdup+0x1b/0x40 mm/util.c:118
 kmemdup include/linux/string.h:418 [inline]
 ipv4_sysctl_init_net+0x37/0x2e0 net/ipv4/sysctl_net_ipv4.c:1210
 ops_init+0x99/0x380 net/core/net_namespace.c:128
 setup_net+0x2b3/0x650 net/core/net_namespace.c:313
 copy_net_ns+0x1ae/0x2a0 net/core/net_namespace.c:436
 create_new_namespaces+0x483/0x750 kernel/nsproxy.c:107
 unshare_nsproxy_namespaces+0x87/0x1a0 kernel/nsproxy.c:206
 ksys_unshare+0x31b/0x710 kernel/fork.c:2442
 __do_sys_unshare kernel/fork.c:2510 [inline]
 __se_sys_unshare kernel/fork.c:2508 [inline]
 __x64_sys_unshare+0x2c/0x40 kernel/fork.c:2508

Memory state around the buggy address:
 ffff880097592000: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
 ffff880097592080: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
>ffff880097592100: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
                   ^
 ffff880097592180: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
 ffff880097592200: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
==================================================================
----------------
Code disassembly (best guess), 1 bytes skipped:
   0:	ff c3                	inc    %ebx
   2:	66 2e 0f 1f 84 00 00 	nopw   %cs:0x0(%rax,%rax,1)
   9:	00 00 00 
   c:	0f 1f 40 00          	nopl   0x0(%rax)
  10:	48 89 f8             	mov    %rdi,%rax
  13:	48 89 f7             	mov    %rsi,%rdi
  16:	48 89 d6             	mov    %rdx,%rsi
  19:	48 89 ca             	mov    %rcx,%rdx
  1c:	4d 89 c2             	mov    %r8,%r10
  1f:	4d 89 c8             	mov    %r9,%r8
  22:	4c 8b 4c 24 08       	mov    0x8(%rsp),%r9
  27:	0f 05                	syscall 
  29:	48 3d 01 f0 ff ff    	cmp    $0xfffffffffffff001,%rax <-- trapping instruction
  2f:	73 01                	jae    0x32
  31:	c3                   	retq   
  32:	48 c7 c1 bc ff ff ff 	mov    $0xffffffffffffffbc,%rcx
  39:	f7 d8                	neg    %eax
  3b:	64 89 01             	mov    %eax,%fs:(%rcx)
  3e:	48                   	rex.W

